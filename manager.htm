<!DOCTYPE html>




<html>

<head>



  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link rel="shortcut icon" href="https://www.beizijinfu.com/hplus/favicon.ico">

  <!-- 引入jQuery -->
  <link href="https://www.beizijinfu.com/hplus/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/bootstrap-spinner.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/font-awesome.min93e3.css?v=4.4.0" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/animate.min.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/style.min.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/plugins/treeview/bootstrap-treeview.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/plugins/jsTree/style.min.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/plugins/select/bootstrap-select.min.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/bootstrap.min14ed.css?v=3.3.6" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/animate.min.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/style.min862f.css?v=4.1.0" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/jquery.treegrid.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/plugins/toastr/toastr.min.css">
  <link href="https://www.beizijinfu.com/hplus/favicon.ico" rel="shortcut icon">
  <link href="https://www.beizijinfu.com/hplus/css/plugins/iCheck/custom.css" rel="stylesheet">

  <link href="hplus/css/logo+navbar20170905.css" rel="stylesheet">




  <meta http-equiv="X-UA-Compatible" content="edge" />
  <title>成员管理</title>
</head>

<body class="gray-bg">
  <div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
      <div class="col-sm-12">
        <div class="ibox">
          <div class="ibox-title ibox-title-red">
            成员管理
          </div>
          <div class="ibox-content">
            <div class="row">
              <div class="col-xs-3">
                <div class="form-group">
                  <div class="input-group">
                    <input type="text" id="q_name" class="form-control inline" placeholder="输入成员账号查询">
                    <span class="input-group-btn"><button type="button" onclick="getfun();" class="btn btn-primary">查询</button></span>
                  </div>
                </div>
              </div>
              <div class="col-xs-offset-3 col-xs-6">
                <form method="get" class="text-right">
                  <div class="btn-group">
                    <a href="https://www.beizijinfu.com/userchild/addPage.htm" class="btn btn-white"><i class="fa fa-plus"></i> 创建新成员</a>
                    <button type="button" onclick="resetUserPwd();" class="btn btn-white "><i class="fa fa-gear"></i> 重置密码</button>
                    <button type="button" onclick="deleteFun();" class="btn btn-white"><i class="fa fa-trash"></i> 删除</button>
                  </div>
                </form>
              </div>
            </div>
            <table id="dataGrid" class="table table-striped  table-hover table-bordered">
              <thead class="text-center ">
                <tr>
                  <th>
                    <label>
                      <input type="checkbox" class="checkall i-checks" /> 全选
                    </label>
                  </th>
                  <th>序号</th>
                  <th>成员账号</th>
                  <th>昵称</th>
                  <th>操作</th>
                </tr>
              </thead>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>



  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link rel="shortcut icon" href="https://www.beizijinfu.com/style/images/index/favicon.png" />

  <script src="https://www.beizijinfu.com/hplus/js/jquery-2.2.3.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/bootstrap.min.js?v=3.3.6"></script>

  <!-- 引入my97日期时间控件 -->


  <!-- 扩展表单校验 -->


  <!-- 三级联动 -->
  <script type="text/javascript" src="https://www.beizijinfu.com/jslib/select/area.js" charset="utf-8"></script>

  <!-- ajax 文件上传 -->
  <script type="text/javascript" src="https://www.beizijinfu.com/jslib/ajaxfileupload.js" charset="utf-8"></script>
  <script type="text/javascript" src="https://www.beizijinfu.com/jslib/extJquery.js" charset="utf-8"></script>


  <link rel="stylesheet" href="https://www.beizijinfu.com/kindeditor-4.1.10/themes/default/default.css" />
  <script charset="utf-8" src="https://www.beizijinfu.com/kindeditor-4.1.10//kindeditor-min.js"></script>
  <script charset="utf-8" src="https://www.beizijinfu.com/kindeditor-4.1.10//lang/zh_CN.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/metisMenu/jquery.metisMenu.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/layer/layer.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/pace/pace.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/contabs.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/hplus.min.js?v=4.1.0"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/jeditable/jquery.jeditable.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/dataTables/jquery.dataTables.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/dataTables/dataTables.bootstrap.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/jquery.spinner.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/validate/jquery.metadata.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/validate/jquery.validate.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/validate/messages_zh.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/treeview/bootstrap-treeview.js"></script>

  <script src="https://www.beizijinfu.com/hplus/js/plugins/treeview/jsonToTree.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/jsTree/jstree.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/select/bootstrap-select.min.js"></script>
  <script src="https://www.beizijinfu.com/js/colResizable-1.6.js"></script>
  <script src="https://www.beizijinfu.com/js/ajaxfileupload.js"></script>
  <script src="https://www.beizijinfu.com/js/beizi.validate.js"></script>


  <script type="text/javascript">
    $(window).load(function() {
      $("#loading").fadeOut();
    });



    //公共方法
    var pubMethod = {
      bind: function(control, code) {
        if (control == '' || code == '') {
          return;
        }

        $('#' + control).combobox({
          url: '/dictionary/combox?code=' + code,
          method: 'get',
          valueField: 'id',
          textField: 'text',
          editable: false,
          panelHeight: 'auto',
          required: true
        });
      }
    }

    function logout() {
      $.post('/admin/logout.htm', function(result) {
        if (result.success) {
          window.location.href = '/index.htm';
        }
      }, 'json');
    }

    function editUserPwd() {
      parent.layer.open({
        type: 2,
        title: "修改密码",
        shade: 0.5,
        area: ['900px', '500px'],
        shift: 2,
        btn: ['提交', '关闭'],
        yes: function(index, layero) {
          var framefrom = parent.window.frames["layui-layer-iframe" + index];
          framefrom.submitForm();
        },
        cancel: function(index, layero) {

        },
        content: ['/user/editPwdPage.htm?id=907902763860750336'],
        end: function(result) {
          getfun();
        }
      });

    }

    function FormatAfterDotNumber(ValueString, nAfterDotNum) {
      var ValueString, nAfterDotNum;
      var resultStr, nTen;
      ValueString = "" + ValueString + "";
      strLen = ValueString.length;
      dotPos = ValueString.indexOf(".", 0);
      if (dotPos == -1) {
        resultStr = ValueString + ".";
        for (i = 0; i < nAfterDotNum; i++) {
          resultStr = resultStr + "0";
        }
        return resultStr;
      } else {
        if ((strLen - dotPos - 1) >= nAfterDotNum) {
          nAfter = dotPos + nAfterDotNum + 1;
          nTen = 1;
          for (j = 0; j < nAfterDotNum; j++) {
            nTen = nTen * 10;
          }
          resultStr = Math.round(parseFloat(ValueString) * nTen) / nTen;
          return resultStr;
        } else {
          resultStr = ValueString;
          for (i = 0; i < (nAfterDotNum - strLen + dotPos + 1); i++) {
            resultStr = resultStr + "0";
          }
          return resultStr;
        }
      }
    }
  </script>


  <script src="https://www.beizijinfu.com/hplus/js/jquery.treegrid.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/jquery.treegrid.bootstrap3.js"></script>

  <script src="https://www.beizijinfu.com/hplus/js/bootstrap-number-input.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/toastr/toastr.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/layer/laydate/laydate.js"></script>





  <script type="text/javascript" src="http://tajs.qq.com/stats?sId=9051096" charset="UTF-8"></script>

  <script type="text/javascript">
    $.canEdit = true;
  </script>
  <script>
    $(function() {
      load_table();
    });
    var _dataTable;

    function load_table() {
      //var name = $("#q_name").val();
      _dataTable = $('#dataGrid').dataTable({
        ajax: {
          url: '' + '/userchild/dataGrid.htm',
          type: "POST",
          error: function(xhr, error, thrown) {

          },
          data: function(data) {
            for (var i = 0; i < data.columns.length; i++) {
              column = data.columns[i];
              column.searchRegex = column.search.regex;
              column.searchValue = column.search.value;
              delete(column.search);
            }
            data.child_userid = $("#q_name").val();
          }
        },
        bSort: false,
        sAjaxDataProp: "rows",
        bServerSide: true,
        searching: false,
        bLengthChange: true,
        iDisplayStart: 0,
        pagingType: "full_numbers", //详细分页组，可以支持直接跳转到某页  
        order: [
          [2, "desc"]
        ],
        bInfo: true,
        columns: [

          {
            sClass: "text-center",
            data: "id",
            width: "60px",
            render: function(data, type, full, meta) {
              return '<input type="checkbox"  class="checkchild i-checks" name="checkchild"  value="' + data + '" />';
            },
            bSortable: false
          }, {
            data: null,
            sClass: "text-center"
          }, {
            data: "child_userid",
            sClass: "text-center"
          }, {
            data: "user_name",
            sClass: "text-center"
          }, {
            data: null,
            sClass: "text-center"
          }
        ],
        columnDefs: [{
          targets: 4,
          render: function(data, type, row) {
            var str = '&nbsp;';
            if (!row.id)
              return str;
            if (row.isdefault != 0) {
              if ($.canEdit) {
                str += $.formatString('<a href="https://www.beizijinfu.com/userchild/editPage.htm?id={0}" class="btn btn-white btn-sm" style="border-radius: 15px"><i class="fa fa-pencil"></i>编辑</a></td>', row.id);
              }

            }
            return str;
          }
        }],
        fnDrawCallback: function() {　　
          this.api().column(1).nodes().each(function(cell, i) {　　　　
            cell.innerHTML = i + 1;　　
          });
          $(".i-checks").iCheck({
            checkboxClass: "icheckbox_square-green",
            radioClass: "iradio_square-green"
          });
        },
        oLanguage: {
          "oPaginate": {
            "sFirst": "首页",
            "sPrevious": "前一页",
            "sNext": "后一页",
            "sLast": "尾页"
          }
        }
      });

      $(".checkall").click(function() {
        var check = $(this).prop("checked");
        $(".checkchild").prop("checked", check);
      });

      $(function() {
        $("table").colResizable();
      });
    }

    function getfun() {
      _dataTable.fnDraw();
    }

    function fromReset() {
      $("#q_name").val("");
    }

    function deleteFun() {

      var checkchild = "";

      $("input:checkbox[name='checkchild']:checked").each(function() {
        checkchild += $(this).val() + ",";
      });

      checkchild = checkchild.substr(0, checkchild.length - 1);

      if (checkchild == "") {
        parent.layer.alert("请选择至少一个员工!");
        return;
      }

      //询问框
      parent.layer.confirm('您是否要删除该员工？', {
        icon: 3,
        title: '提示',
        btn: ['确定', '取消'],
        shade: false
      }, function() {
        progressLoad();
        $.post('/userchild/delete.htm', {
          id: checkchild
        }, function(result) {
          if (result.success) {
            parent.layer.alert(result.msg, {
              time: 1000
            });
            getfun();
          }
          progressClose();
        }, 'JSON');
      }, function() {

      });
    }

    function resetUserPwd() {

      var checkchild = "";

      $("input:checkbox[name='checkchild']:checked").each(function() {
        checkchild += $(this).val() + ",";
      });

      checkchild = checkchild.substr(0, checkchild.length - 1);

      if (checkchild.split(",").length > 1 || checkchild == "") {
        parent.layer.alert("请选择一个员工，并且只能选择一个员工!");
        return;
      }

      //询问框
      parent.layer.confirm('确定要重置该员工密码？', {
        icon: 3,
        title: '提示',
        btn: ['确定', '取消'],
        shade: false
      }, function() {
        progressLoad();
        $.post('/userchild/resetUserPwd.htm', {
          id: checkchild
        }, function(result) {
          if (result.success) {
            parent.layer.alert(result.msg, {
              icon: 1
            });
          }
          progressClose();
        }, 'JSON');
      }, function() {

      });
    }
  </script>

</body>

</html>
