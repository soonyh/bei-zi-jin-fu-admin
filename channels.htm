<!DOCTYPE html>




<html>

<head>



  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link rel="shortcut icon" href="https://www.beizijinfu.com/hplus/favicon.ico">

  <!-- 引入jQuery -->
  <link href="https://www.beizijinfu.com/hplus/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/bootstrap-spinner.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/font-awesome.min93e3.css?v=4.4.0" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/animate.min.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/style.min.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/plugins/treeview/bootstrap-treeview.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/plugins/jsTree/style.min.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/plugins/select/bootstrap-select.min.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/bootstrap.min14ed.css?v=3.3.6" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/animate.min.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/style.min862f.css?v=4.1.0" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/jquery.treegrid.css" rel="stylesheet">
  <link href="https://www.beizijinfu.com/hplus/css/plugins/toastr/toastr.min.css">
  <link href="https://www.beizijinfu.com/hplus/favicon.ico" rel="shortcut icon">
  <link href="https://www.beizijinfu.com/hplus/css/plugins/iCheck/custom.css" rel="stylesheet">

  <link href="hplus/css/logo+navbar20170905.css" rel="stylesheet">




  <meta http-equiv="X-UA-Compatible" content="edge" />
  <title>用户通道管理</title>
  <style type="text/css">
    .mybtn {
      display: inline-block;
      margin-bottom: 0;
      font-weight: normal;
      text-align: center;
      vertical-align: middle;
      -ms-touch-action: manipulation;
      touch-action: manipulation;
      cursor: pointer;
      background-image: none;
      border: 1px solid transparent;
      white-space: nowrap;
      padding: 1px 10px;
      font-size: 14px;
      line-height: 1.42857143;
      border-radius: 4px;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      color: #fff
    }
  </style>
</head>

<body class="gray-bg">
  <div class="wrapper wrapper-content animated fadeInRight">
    <div class="alert alert-info alert-dismissable" id="alert">
      <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
      您已经开通支付通道，请在以下列表找到您的通道进行参数配置，如果尚未开通通道，请在此处申请开通。
    </div>
    <div class="row">
      <div class="col-sm-12">
        <div class="ibox float-e-margins">
          <div class="ibox-title ibox-title-red">
            <h5>订单查询</h5>
          </div>
          <div class="ibox-content">
            <div class="row table-toolbar-top">
              <form role="form" class="form-inline col-xs-7">
                <div class="form-group">
                  <label for="" class="form-label">通道状态：</label>
                  <div class="input-group">
                    <select id="status" name="status" data-placeholder="请选择..." class="form-control">
                      <option value="" />全部
                      <option value="2" />已配置
                      <option value="1" />未配置
                      <option value="0" />已启用
                      <option value="-1" />已停用
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label for="" class="form-label">通道：</label>
                  <select id="channel_type" name="" channel_type "" data-placeholder="选择通道..." class="form-control">
                    <option value="" />请选择通道

                    <option value="WX" />微信支付

                    <option value="ALI" />支付宝支付

                    <option value="QK" />快捷支付

                    <option value="DQ" />代付

                  </select>
                </div>
                <button class="btn btn-primary" type="button" onclick="Search()">查询</button>
              </form>
              <div class="col-xs-5 text-right">
                <a href="apply.htm" class="btn btn-primary">申请开通渠道</a>&nbsp;
                <a href="https://www.beizijinfu.com/channelrecord/manager.htm" class="btn btn-default">申请历史记录</a>
              </div>
            </div>
            <table id="dataGrid" class="table table-striped  table-hover table-bordered table-container" style="width:100%">
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link rel="shortcut icon" href="https://www.beizijinfu.com/style/images/index/favicon.png" />

  <script src="https://www.beizijinfu.com/hplus/js/jquery-2.2.3.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/bootstrap.min.js?v=3.3.6"></script>

  <!-- 引入my97日期时间控件 -->


  <!-- 扩展表单校验 -->


  <!-- 三级联动 -->
  <script type="text/javascript" src="https://www.beizijinfu.com/jslib/select/area.js" charset="utf-8"></script>

  <!-- ajax 文件上传 -->
  <script type="text/javascript" src="https://www.beizijinfu.com/jslib/ajaxfileupload.js" charset="utf-8"></script>
  <script type="text/javascript" src="https://www.beizijinfu.com/jslib/extJquery.js" charset="utf-8"></script>


  <link rel="stylesheet" href="https://www.beizijinfu.com/kindeditor-4.1.10/themes/default/default.css" />
  <script charset="utf-8" src="https://www.beizijinfu.com/kindeditor-4.1.10//kindeditor-min.js"></script>
  <script charset="utf-8" src="https://www.beizijinfu.com/kindeditor-4.1.10//lang/zh_CN.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/metisMenu/jquery.metisMenu.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/layer/layer.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/pace/pace.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/contabs.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/hplus.min.js?v=4.1.0"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/jeditable/jquery.jeditable.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/dataTables/jquery.dataTables.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/dataTables/dataTables.bootstrap.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/jquery.spinner.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/validate/jquery.metadata.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/validate/jquery.validate.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/validate/messages_zh.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/treeview/bootstrap-treeview.js"></script>

  <script src="https://www.beizijinfu.com/hplus/js/plugins/treeview/jsonToTree.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/jsTree/jstree.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/select/bootstrap-select.min.js"></script>
  <script src="https://www.beizijinfu.com/js/colResizable-1.6.js"></script>
  <script src="https://www.beizijinfu.com/js/ajaxfileupload.js"></script>
  <script src="https://www.beizijinfu.com/js/beizi.validate.js"></script>


  <script type="text/javascript">
    $(window).load(function() {
      $("#loading").fadeOut();
    });



    //公共方法
    var pubMethod = {
      bind: function(control, code) {
        if (control == '' || code == '') {
          return;
        }

        $('#' + control).combobox({
          url: '/dictionary/combox?code=' + code,
          method: 'get',
          valueField: 'id',
          textField: 'text',
          editable: false,
          panelHeight: 'auto',
          required: true
        });
      }
    }

    function logout() {
      $.post('/admin/logout.htm', function(result) {
        if (result.success) {
          window.location.href = '/index.htm';
        }
      }, 'json');
    }

    function editUserPwd() {
      parent.layer.open({
        type: 2,
        title: "修改密码",
        shade: 0.5,
        area: ['900px', '500px'],
        shift: 2,
        btn: ['提交', '关闭'],
        yes: function(index, layero) {
          var framefrom = parent.window.frames["layui-layer-iframe" + index];
          framefrom.submitForm();
        },
        cancel: function(index, layero) {

        },
        content: ['/user/editPwdPage.htm?id=907902763860750336'],
        end: function(result) {
          getfun();
        }
      });

    }

    function FormatAfterDotNumber(ValueString, nAfterDotNum) {
      var ValueString, nAfterDotNum;
      var resultStr, nTen;
      ValueString = "" + ValueString + "";
      strLen = ValueString.length;
      dotPos = ValueString.indexOf(".", 0);
      if (dotPos == -1) {
        resultStr = ValueString + ".";
        for (i = 0; i < nAfterDotNum; i++) {
          resultStr = resultStr + "0";
        }
        return resultStr;
      } else {
        if ((strLen - dotPos - 1) >= nAfterDotNum) {
          nAfter = dotPos + nAfterDotNum + 1;
          nTen = 1;
          for (j = 0; j < nAfterDotNum; j++) {
            nTen = nTen * 10;
          }
          resultStr = Math.round(parseFloat(ValueString) * nTen) / nTen;
          return resultStr;
        } else {
          resultStr = ValueString;
          for (i = 0; i < (nAfterDotNum - strLen + dotPos + 1); i++) {
            resultStr = resultStr + "0";
          }
          return resultStr;
        }
      }
    }
  </script>


  <script src="https://www.beizijinfu.com/hplus/js/jquery.treegrid.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/jquery.treegrid.bootstrap3.js"></script>

  <script src="https://www.beizijinfu.com/hplus/js/bootstrap-number-input.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/toastr/toastr.min.js"></script>
  <script src="https://www.beizijinfu.com/hplus/js/plugins/layer/laydate/laydate.js"></script>





  <script src="https://www.beizijinfu.com/hplus/js/plugins/validate/jquery.validate.min.js"></script>
  <script>
    $(function() {
      load_table();
    });
    var _dataTable;

    function load_table() {
      _dataTable = $('#dataGrid').dataTable({
        ajax: {
          url: '' + '/userchannel/channelsdata.htm',
          type: "POST",
          error: function(xhr, error, thrown) {},
          data: function(data) {
            for (var i = 0; i < data.columns.length; i++) {
              column = data.columns[i];
              column.searchRegex = column.search.regex;
              column.searchValue = column.search.value;
              delete(column.search);
            }
            data.status = $("#status").val();
            data.channel_type = $("#channel_type").val();
          }
        },
        bAutoWith: true,
        bSort: false,
        sAjaxDataProp: "rows",
        bServerSide: true,
        searching: false,
        bLengthChange: true,
        iDisplayStart: 0,
        pagingType: "full_numbers",
        paging: false,
        order: [
          [4, "desc"]
        ],
        bInfo: true,
        columns: [{
            title: "序号",
            data: null,
            sClass: "text-center",
            width: "5%"
          }, {
            title: "通道",
            data: "channel_name",
            sClass: "text-center",
            width: "12%"
          }, {
            title: "支持的场景",
            data: "scene_type",
            sClass: "text-center",
            width: "18%",
            render: function(data, type, full, meta) {
              scenes = data.split(",");
              var result = "";
              for (i in scenes) {

                if ('APP' == scenes[i]) {
                  if (result != "") {
                    result += "/";
                  }
                  result += '手机App支付';
                }

                if ('WEB' == scenes[i]) {
                  if (result != "") {
                    result += "/";
                  }
                  result += '电脑网页支付';
                }

                if ('WAP' == scenes[i]) {
                  if (result != "") {
                    result += "/";
                  }
                  result += '手机网页支付';
                }

                if ('JSAPI' == scenes[i]) {
                  if (result != "") {
                    result += "/";
                  }
                  result += '微信公众号支付';
                }

                if ('WXAPP' == scenes[i]) {
                  if (result != "") {
                    result += "/";
                  }
                  result += '微信小程序支付';
                }

              }
              return result;
            }
          }, {
            title: "状态",
            data: "status",
            sClass: "text-center",
            width: "8%",
            render: function(data, type, full, meta) {
              if (data == -1) {
                return "已停用";
              } else if (data == 0) {
                return "已启用";
              } else if (data == 1) {
                return "未配置";
              } else if (data == 2) {
                return "已配置";
              }
            }
          }, {
            title: "通道编码",
            data: "channel_code",
            sClass: "text-center",
            width: "8%",
            visible: false
          }, {
            title: "用户通道编码",
            data: "id",
            sClass: "text-center",
            width: "8%",
            visible: false
          }, {
            title: "操作",
            data: "status",
            sClass: "text-center",
            width: "8%",
            render: function(data, type, row) {
              var str = '&nbsp;';
              if (data != 0) {
                str += $.formatString('<span class="label label-primary"><a href="javascript:void(0)" class="mybtn " onclick="config(\'{0}\',\'{1}\',\'{2}\');" >配置</a></span>', row.channel_type, row.channel_code, row.id);
              } else {
                str += $.formatString('<span class="label label-default disabled" ><a href="javascript:void(0)" class="mybtn " title="已启用，无法配置">配置</a></span>');
              }

              return str;
            }
          }

        ],
        fnDrawCallback: function() {
          this.api().column(0).nodes().each(function(cell, i) {
            cell.innerHTML = i + 1;
          });
        },
        oLanguage: {
          "oPaginate": {
            "sFirst": "首页",
            "sPrevious": "前一页",
            "sNext": "后一页",
            "sLast": "尾页"
          }
        }
      });

      $(".checkall").click(function() {
        var check = $(this).prop("checked");
        $(".checkchild").prop("checked", check);
      });

    }

    function config(channel_type, channel_code, id) {
      parent.layer.open({
        type: 2,
        title: "参数配置",
        shade: 0.5,
        area: ['800px', '500px'],
        shift: 2,
        btn: ['提交', '关闭'], //按钮
        yes: function(index, layero) {
          var framefrom = parent.window.frames["layui-layer-iframe" + index];
          var data = "";

          var targetname = "#" + channel_type + " input";

          if (framefrom.$(targetname).length == 0) {
            targetname = "#OTHER input";
          };

          framefrom.$(targetname).each(function(i) {
            if (!$(this).valid()) {
              return;
            }
            if (data != "") {
              data += ",";
            }
            data += '"' + $(this).attr("name") + '":"' + $(this).val() + '"';
          });

          if (data == "") {
            return;
          }

          framefrom.$("#channel_detail").val("{" + data + "}");

          var _url = '/userchannel/addDetail.htm';
          if (id != null && id != "") {
            _url = '/userchannel/editDetail.htm';
          }

          $.ajax({
            cache: true,
            type: "POST",
            url: _url,
            data: framefrom.$("#userchanneladdform").serialize(), // 你的formid
            async: false,
            error: function(result) {
              parent.layer.alert(result);
            },
            success: function(result) {
              result = $.parseJSON(result);
              var success = result.success;
              if (success) {
                parent.layer.alert("配置成功");
                parent.layer.close(index);
              } else {
                parent.layer.alert("配置失败");
              }
            }
          });
        },
        cancel: function(index, layero) {

        },
        content: ['/userchannel/config.htm?id=' + id + '&channel_code=' + channel_code + '&channel_type=' + channel_type, 'auto'], //iframe的url，no代表不显示滚动条
        end: function(result) {
          Search();
        }
      });

    }

    function fromReset() {
      $("#mer_name").val("");
    }

    function Search() {
      var oSettings = _dataTable.fnSettings();
      _dataTable.fnDraw(oSettings);
    }

    $.validator.setDefaults({
      highlight: function(e) {
        $(e).closest(".form-group").removeClass("has-success").addClass("has-error")
      },
      success: function(e) {
        e.closest(".form-group").removeClass("has-error").addClass("has-success")
      },
      errorElement: "span",
      errorPlacement: function(e, r) {
        e.appendTo(r.is(":radio") || r.is(":checkbox") ? r.parent().parent().parent() : r.parent())
      },
      errorClass: "help-block m-b-none",
      validClass: "help-block m-b-none"
    });

    $.extend($.validator.messages, {
      required: "必填",
    });
  </script>
</body>

</html>
